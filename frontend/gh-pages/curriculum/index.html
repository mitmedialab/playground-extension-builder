<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google" value="notranslate">
    <link rel="shortcut icon" href="static/favicon.ico">
    <title>PRG AI Blocks</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        background-color: #f0f0f0; /* Light background color for contrast */
      }

      .top-panel {
        width: 100%;
        height: 6.5%;
        background-color: #333;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 10px;
        box-sizing: border-box;
        font-size: 16px;
        position: absolute;
        z-index: 1000;
        
      }

      .container {
        width: 100%;
        height: 94.5%; /* Full height minus top panel */
        box-sizing: border-box;
        background-color: #fff; /* White background for content */
        border: 1px solid #ccc; /* Optional: border for clarity */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Optional: subtle shadow */
        overflow: auto; /* Handles overflow content */
        position: absolute;
        top: 6%; /* Starts below the top panel */
        left: 0px;
        z-index: 1000;
      }

      #codeEditor {
        width: 100%;
        height: 200px;
        font-family: 'Courier New', Courier, monospace;
        font-size: 14px;
        background-color: #1e1e1e;
        color: #d4d4d4;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 10px;
        box-sizing: border-box;
        resize: vertical; /* Allow vertical resizing */
      }

    </style>
    <script defer src="runtime.js"></script>
    <script defer src="chunks/vendors-node_modules_pnpm_microbit_microbit-universal-hex_0_2_2_tslib_2_6_2_node_modules_micr-8f889f.6dce1edea4e57eb3ccf5.js"></script>
    <script defer src="chunks/vendors-node_modules_pnpm_core-js_2_6_12_node_modules_core-js_fn_array_includes_js-node_modul-b41ce8.1be7cd83ab653a07364e.js"></script>
    <script defer src="chunks/src_containers_gui_jsx-src_lib_app-state-hoc_jsx-src_lib_hash-parser-hoc_jsx.de77fb775aa9f3e9d0f9.js"></script>
    <script defer src="gui.js"></script>
  </head>
  <body>
    <div class="top-panel">
      <span>PRG AI Blocks</span>
      <button id="toggleContainerButton">Hide Container</button>
    </div>
    <div class="container" id="mainContainer">
      <h1>Hello from the Frontend!</h1>
      <div>
        <textarea id="codeEditor">// Write your code here...</textarea>
        <button id="buildButton">Run Build</button>
        <button id="saveButton">Save to File</button> <!-- New button -->
        <div id="status"></div>
        <div id="output"></div> <!-- This will display the command output -->
      </div>
    </div>
    <script>
      const toggleContainerButton = document.getElementById('toggleContainerButton');
      const mainContainer = document.getElementById('mainContainer');

      toggleContainerButton.addEventListener('click', () => {
        if (mainContainer.style.display === 'none') {
          mainContainer.style.display = 'block';
          toggleContainerButton.textContent = 'Hide Container';
        } else {
          mainContainer.style.display = 'none';
          toggleContainerButton.textContent = 'Show Container';
        }
      });

      const buildButton = document.getElementById('buildButton');
      const saveButton = document.getElementById('saveButton'); // New button reference
      const statusElement = document.getElementById('status');
      const outputElement = document.getElementById('output');
      const codeEditor = document.getElementById('codeEditor');

      buildButton.addEventListener('click', async () => {
        const code = codeEditor.value; // Get the code from the editor
        statusElement.textContent = 'Running...';
        outputElement.textContent = ''; // Clear previous output

        try {
          const response = await fetch('/run-command', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ code }), // Send the code to the backend
          });

          if (response.ok) {
            const message = await response.text(); // Retrieve the response text
            console.log('Success:', message);
            outputElement.textContent = `Success: ${message}`;
          } else {
            const errorMessage = await response.text();
            console.error('Error:', errorMessage);
            outputElement.textContent = `Error: ${errorMessage}`;
          }
        } catch (error) {
          console.error('Fetch error:', error);
          outputElement.textContent = `Fetch error: ${error.message}`;
        }
      });

      // New event listener for saving to a file
      saveButton.addEventListener('click', async () => {
        const code = codeEditor.value; // Get the code from the editor
        console.log("CODE", code);
        statusElement.textContent = 'Saving...';

        try {
          const response = await fetch('/write-file', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ content: code }), // Send the code to the write-file API
          });

          if (response.ok) {
            const message = await response.text(); // Retrieve the response text
            console.log('File saved:', message);
            outputElement.textContent = `File saved: ${message}`;
          } else {
            const errorMessage = await response.text();
            console.error('Error saving file:', errorMessage);
            outputElement.textContent = `Error saving file: ${errorMessage}`;
          }
        } catch (error) {
          console.error('Fetch error:', error);
          outputElement.textContent = `Fetch error: ${error.message}`;
        }
      });
    </script>
  </body>
</html>
